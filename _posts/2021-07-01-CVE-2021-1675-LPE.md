---
title: CVE-2021-1675-LPE-EXP-本地提权无需密码
tags: 提权
---
### 一、

暂不讨论网上很多的2016以及2019成功情况，来讨论讨论真实情况，首先我花了两天时间测试了2012r2为域控的环境

除了用户在`Domain Admins`和`Enterprise Admins`这两个域内高权限组的用户去调用`RpcAddPrinterDriverEx`都会是`access_denied`，感觉还是有很大的限制，所以感觉目前的情况可能这个漏洞作为“武器化”的本地提权漏洞更为合适，所以用`EnumPrinterDriversW`先获取本机的驱动接口，解决了一个利用条件；以及不需要本地用户的口令即可食用。

### 二、

另外，测试2008的`pDriverPath`为

```
C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_neutral_4616c3de1949be6d\Amd64\
```

测试使用`EnumPrinterDriversW`无法获取此路径，所以可以自行修改此路径，有师傅知道还有通用的方法获取`pDriverPath`的希望一起交流

### 三、

```
Usage: 
POC.exe C:\test\MyPigDLL.dll
```

MyPigDLL.dll:：

```
测试DLL，成功后会自动创建C:\test.txt
以及 C:\Windows\System32\spool\drivers\x64\3 目录下会出现 MyPigDLL.dll
```

此本地提权EXP测试如下成功:

```
Microsoft Windows Server 2012 R2 Datacenter [版本 6.3.9600]
Microsoft Windows 10 专业版 [版本 10.0.19041.685]
Microsoft Windows Server 2008 R2 Enterprise [版本 6.1.7601]
```

下载链接:https://github.com/evilashz/CVE-2021-1675-LPE-EXP

### 参考

​		http://noahblog.360.cn/untitled-3/

​		https://github.com/afwu/PrintNightmare